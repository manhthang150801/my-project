import{k as P,u as $,r as s,j as e,S as F,M as O}from"./index-CQdfBo2t.js";const z=()=>{const m="/api/v1",{id:d}=P(),h=$(),[r,g]=s.useState({incomeCode:"",incomeName:""}),[o,u]=s.useState({incomeCode:"",incomeName:""}),[j,p]=s.useState(!1),[b,C]=s.useState(""),[v,k]=s.useState(""),[f,S]=s.useState(!1),[T,c]=s.useState(!1),[x,N]=s.useState("");s.useEffect(()=>{(async()=>{c(!0);try{const t=localStorage.getItem("token"),n=await fetch(`${m}/incomes/${d}`,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(n.status===401){const L=await n.json();N(L.detail),a("Thông báo","Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại.",!0),c(!1);return}const l=await n.json();l?g({incomeCode:l.incomeCode,incomeName:l.incomeName}):a("Lỗi","Không tìm thấy thông tin thu nhập.",!0)}catch{a("Lỗi","Có lỗi xảy ra khi tải dữ liệu.",!0)}finally{c(!1)}})()},[d,m]);const y=i=>{const{name:t,value:n}=i.target;g({...r,[t]:n}),u({...o,[t]:""})},w=()=>r.incomeCode.trim()?r.incomeName.trim()?!0:(u({...o,incomeName:"Tên thu nhập không được để trống."}),!1):(u({...o,incomeCode:"Mã thu nhập không được để trống."}),!1),M=async()=>{if(w()){c(!0);try{const i=localStorage.getItem("token"),t=await fetch(`${m}/incomes`,{method:"PUT",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({id:d,...r})});if(t.status===401){const l=await t.json();N(l.detail),a("Thông báo","Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại.",!0),c(!1);return}const n=await t.json();n&&n.message==="updated"?a("Thành công","Cập nhật thành công!",!1):a("Lỗi","Cập nhật không thành công.",!0)}catch{a("Lỗi","Có lỗi xảy ra khi cập nhật.",!0)}finally{c(!1)}}},I=()=>{h(-1)},a=(i,t,n)=>{C(i),k(t),S(n),p(!0)},E=()=>{p(!1),f||h(-1),(x=="invalid_token"||x=="jwt_error")&&(localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("roles"),h("/"))};return e.jsxs("div",{className:"flex items-center justify-center min-h-screen p-4 bg-gray-100 relative",children:[T&&e.jsx("div",{className:"fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50",children:e.jsx(F,{})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800 text-center",children:"Cập Nhật Thu Nhập"}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"incomeCode",className:"block text-gray-700 font-medium mb-2",children:"Mã Thu Nhập"}),e.jsx("input",{type:"text",id:"incomeCode",name:"incomeCode",value:r.incomeCode,onChange:y,className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-indigo-300",placeholder:"Nhập mã thu nhập"}),o.incomeCode&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:o.incomeCode})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"incomeName",className:"block text-gray-700 font-medium mb-2",children:"Tên Thu Nhập"}),e.jsx("input",{type:"text",id:"incomeName",name:"incomeName",value:r.incomeName,onChange:y,className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-indigo-300",placeholder:"Nhập tên thu nhập"}),o.incomeName&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:o.incomeName})]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{type:"button",onClick:M,className:"px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 focus:outline-none focus:ring focus:ring-indigo-300",children:"Cập Nhật"}),e.jsx("button",{type:"button",onClick:I,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 focus:outline-none focus:ring focus:ring-gray-200",children:"Hủy"})]})]})]}),e.jsx(O,{isOpen:j,onClose:E,title:b,message:v,isError:f})]})};export{z as default};
