import{r as t,u as z,j as e,S as F,h as R,i as _,M as G}from"./index-CQdfBo2t.js";import{C as U}from"./ConfirmModal-DPzGQM7w.js";const K=()=>{const g="/api/v1",[b,c]=t.useState([]),[v,l]=t.useState(!1),[C,f]=t.useState(!1),[T,k]=t.useState(""),[M,E]=t.useState(""),[I,$]=t.useState(!1),[L,d]=t.useState(!1),[h,j]=t.useState(null),[y,N]=t.useState(""),w=z(),[S,P]=t.useState(0),[o,p]=t.useState(0),x=10;t.useEffect(()=>{D(o,x)},[h,o,x]);const D=async(s=0,a=x)=>{l(!0);try{const n=localStorage.getItem("token"),B=s*a,m=await fetch(`${g}/all-jobs?skip=${B}&limit=${a}`,{method:"GET",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(m.status===401){const u=await m.json();N(u.detail),r("Thông báo","Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại.",!0),l(!1);return}const i=await m.json();if(i&&Array.isArray(i.content)){if(c(i.content),i.totalCount){const u=Math.ceil(i.totalCount/a);P(u)}}else c([]);p(s)}catch{r("Lỗi","Có lỗi xảy ra khi tải dữ liệu.",!0)}finally{l(!1)}},O=s=>{w(`/dashboard/update-job/${s}`)},X=s=>{j(s),d(!0)},A=async()=>{d(!1),l(!0);try{const s=localStorage.getItem("token"),a=await fetch(`${g}/jobs/${h}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(a.status===401){const n=await a.json();N(n.detail),r("Thông báo","Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại.",!0),l(!1);return}a.ok?(c(b.filter(n=>n.id!==h)),r("Thành công","Xóa thành công!",!1)):r("Lỗi","Xóa không thành công.",!0)}catch{r("Lỗi","Có lỗi xảy ra khi xóa.",!0)}finally{l(!1),j(null)}},r=(s,a,n)=>{k(s),E(a),$(n),f(!0)},J=()=>{f(!1),(y=="invalid_token"||y=="jwt_error")&&(localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("roles"),w("/"))};return e.jsxs("div",{className:"flex items-center justify-center min-h-screen p-4 bg-gray-100 relative",children:[v&&e.jsx("div",{className:"fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50",children:e.jsx(F,{})}),e.jsx("div",{className:"container mx-auto p-1",children:e.jsxs("div",{className:"bg-white p-1 rounded shadow-md w-full",children:[e.jsx("h2",{className:"text-2xl text-center mb-4 text-gray-800",children:"Danh Sách Nghề Nghiệp"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"border bg-white w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border-b whitespace-nowrap",children:"Mã Nghề Nghiệp"}),e.jsx("th",{className:"py-2 px-4 border-b whitespace-nowrap",children:"Tên Nghề Ngiệp"}),e.jsx("th",{className:"py-2 px-4 border-b whitespace-nowrap",children:"Sửa"}),e.jsx("th",{className:"py-2 px-4 border-b whitespace-nowrap",children:"Xóa"})]})}),e.jsx("tbody",{children:b.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 px-4 border-b",children:s.jobCode}),e.jsx("td",{className:"py-2 px-4 border-b",children:s.jobName}),e.jsx("td",{className:"py-2 px-4 border-b",children:e.jsxs("button",{onClick:()=>O(s.id),className:"text-blue-500 hover:text-blue-700 flex items-center",children:[e.jsx(R,{}),e.jsx("span",{className:"hidden sm:inline",children:"Sửa"})]})}),e.jsx("td",{className:"py-2 px-4 border-b",children:e.jsxs("button",{onClick:()=>X(s.id),className:"text-red-500 hover:text-red-700 flex items-center",children:[e.jsx(_,{}),e.jsx("span",{className:"hidden sm:inline",children:"Xóa"})]})})]},s.id))})]})}),e.jsxs("div",{className:"flex justify-center mt-4",children:[e.jsx("button",{onClick:()=>p(o-1),disabled:o<=0,className:"px-4 py-2 bg-blue-500 text-white rounded mr-2 disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Trước"}),e.jsx("span",{className:"px-4 py-2",children:`Trang ${o+1} / ${S}`}),e.jsx("button",{onClick:()=>p(o+1),disabled:o>=S-1,className:"px-4 py-2 bg-blue-500 text-white rounded ml-2 disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Sau"})]})]})}),e.jsx(U,{isOpen:L,onClose:()=>d(!1),onConfirm:A,title:"Xác nhận xóa",message:"Bạn có chắc chắn muốn xóa nghề nghiệp này không?"}),e.jsx(G,{isOpen:C,onClose:J,title:T,message:M,isError:I})]})};export{K as default};
