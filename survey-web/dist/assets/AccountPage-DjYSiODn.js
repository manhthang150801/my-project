import{r as t,u as F,j as e,S as R,h as U,i as _,M as G}from"./index-Ca3LY0Wa.js";import{C as K}from"./ConfirmModal-B375nSTh.js";const J=()=>{const p="/api/v1",[S,x]=t.useState([]),[k,o]=t.useState(!1),[v,g]=t.useState(!1),[C,T]=t.useState(""),[E,M]=t.useState(""),[I,$]=t.useState(!1),[A,c]=t.useState(!1),[f,b]=t.useState(null),[j,y]=t.useState(""),w=F(),[N,P]=t.useState(0),[n,d]=t.useState(0),h=10;t.useEffect(()=>{L(n,h)},[f,n,h]);const L=async(s=0,a=h)=>{o(!0);try{const r=localStorage.getItem("token"),z=s*a,m=await fetch(`${p}/users?skip=${z}&limit=${a}`,{method:"GET",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}});if(m.status===401){const u=await m.json();y(u.detail),l("Thông báo","Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại.",!0),o(!1);return}const i=await m.json();if(i&&Array.isArray(i.content)){if(x(i.content),i.totalCount){const u=Math.ceil(i.totalCount/a);P(u)}}else x([]);d(s)}catch{l("Lỗi","Có lỗi xảy ra khi tải dữ liệu.",!0)}finally{o(!1)}},D=s=>{w(`/dashboard/update-account/${s}`)},O=s=>{b(s),c(!0)},X=async()=>{c(!1),o(!0);try{const s=localStorage.getItem("token"),a=await fetch(`${p}/users/${f}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(a.status===401){const r=await a.json();y(r.detail),l("Thông báo","Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại.",!0),o(!1);return}a.ok?l("Thành công","Xóa tài khoản thành công!",!1):l("Lỗi","Xóa tài khoản không thành công.",!0)}catch{l("Lỗi","Có lỗi xảy ra khi xóa tài khoản.",!0)}finally{o(!1),b(null)}},l=(s,a,r)=>{T(s),M(a),$(r),g(!0)},B=()=>{g(!1),(j==="invalid_token"||j==="jwt_error")&&(localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("roles"),w("/"))};return e.jsxs("div",{className:"flex items-center justify-center min-h-screen p-4 bg-gray-100 relative w-full",children:[k&&e.jsx("div",{className:"fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50",children:e.jsx(R,{})}),e.jsx("div",{className:"container mx-auto p-1",children:e.jsxs("div",{className:"bg-white p-1 rounded shadow-md w-full",children:[e.jsx("h2",{className:"text-2xl mb-4 text-gray-800",children:"Danh Sách Tài Khoản"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border-b whitespace-nowrap",children:"Username"}),e.jsx("th",{className:"py-2 px-4 border-b whitespace-nowrap",children:"Email"}),e.jsx("th",{className:"py-2 px-4 border-b whitespace-nowrap",children:"Sửa"}),e.jsx("th",{className:"py-2 px-4 border-b whitespace-nowrap",children:"Xóa"})]})}),e.jsx("tbody",{children:S.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 px-4 border-b",children:s.username}),e.jsx("td",{className:"py-2 px-4 border-b",children:s.email}),e.jsx("td",{className:"py-2 px-4 border-b",children:e.jsxs("button",{onClick:()=>D(s.id),className:"text-blue-500 hover:text-blue-700 flex items-center",children:[e.jsx(U,{}),e.jsx("span",{className:"hidden sm:inline",children:"Sửa"})]})}),e.jsx("td",{className:"py-2 px-4 border-b",children:e.jsxs("button",{onClick:()=>O(s.id),className:"text-red-500 hover:text-red-700 flex items-center",children:[e.jsx(_,{}),e.jsx("span",{className:"hidden sm:inline",children:"Xóa"})]})})]},s.id))})]})}),e.jsxs("div",{className:"flex justify-center mt-4",children:[e.jsx("button",{onClick:()=>d(n-1),disabled:n<=0,className:"px-4 py-2 bg-blue-500 text-white rounded mr-2 disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Trước"}),e.jsx("span",{className:"px-4 py-2",children:`Trang ${n+1} / ${N}`}),e.jsx("button",{onClick:()=>d(n+1),disabled:n>=N-1,className:"px-4 py-2 bg-blue-500 text-white rounded ml-2 disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Sau"})]})]})}),e.jsx(K,{isOpen:A,onClose:()=>c(!1),onConfirm:X,title:"Xác nhận xóa",message:"Bạn có chắc chắn muốn xóa tài khoản này không?"}),e.jsx(G,{isOpen:v,onClose:B,title:C,message:E,isError:I})]})};export{J as default};
